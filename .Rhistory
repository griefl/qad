scale = "abs",
color = "plasma",
white_font = 0.7,
rb_values = c(10, 0.315, 0.15),
title = ""){
prepare_data_long <- function(matr, matr.p, n_round = 3){
df_matr <- as.data.frame(as.table(round(as.matrix(matr), n_round)))
names(df_matr) <- c("Var1", "Var2", "value")
df_p <- as.data.frame(as.table(as.matrix(matr.p)))
names(df_p) <- c("Var1", "Var2", "p.value")
df_p$sign <- with(df_p, ifelse(p.value < sign.level & !is.na(p.value), "*", ""))
df_matr <- dplyr::left_join(df_matr, df_p, by = c("Var1", "Var2"))
df_matr$sign_label <- with(df_matr, ifelse(is.na(value), NA, paste0(value,sign)))
return(df_matr)
}
if(color == "rainbow"){
color_pal <- rainbow(rb_values[1], start = rb_values[2], end = rb_values[3])
}else{
color_pal <- viridis(5, option = color, direction = -1)
}
limit_plot <- c(0,1)
#Select dependence measure
if(select == 'dependence'){
if(use_p.adjust){
df_long <- prepare_data_long(pw_qad$q, pw_qad$q_p.values.adjusted)
}else{
df_long <- prepare_data_long(pw_qad$q, pw_qad$q_p.values)
}
legend_title <- "Dependence: \nq:=q(x,y)"
}else if(select == 'max.dependence'){
if(use_p.adjust){
df_long <- prepare_data_long(pw_qad$max.dependence, pw_qad$max.dependence_p.values.adjusted)
}else{
df_long <- prepare_data_long(pw_qad$max.dependence, pw_qad$max.dependence_p.values)
}
legend_title <- "Max dependence:=\nmax(q(x,y)+q(y,x))"
}else if(select == 'asymmetry'){
if(use_p.adjust){
df_long <- prepare_data_long(pw_qad$asymmetry, pw_qad$asymmetry_p.values.adjusted)
}else{
df_long <- prepare_data_long(pw_qad$asymmetry, pw_qad$asymmetry_p.values)
}
limit_plot <- c(-1,1)
legend_title <- "Asymmetry: \na:=q(x,y)-q(y,x)"
if(color == "rainbow"){
color_pal <- c(rev(rainbow(rb_values[1], start = rb_values[2], end = rb_values[3])),rainbow(rb_values[1], start = rb_values[2], end = rb_values[3])[-1])
}else{
color_pal <- c(rev(viridis(5, option = color, direction = -1)),viridis(5, option = color, direction = -1)[-1])
}
}else{
stop('Select an appropriate select variable. Options are c("dependence","max.dependence","asymmetry")')
}
df_long$text_color <- ifelse(df_long$value > white_font, "high", "low")
#Plot heatmap
p <- ggplot(data = df_long, aes_(x = ~Var2, y = ~Var1, fill = ~value))
p <- p + geom_tile(color = 'white')
if(scale == "rel"){
p <- p + scale_fill_gradientn(colors = color_pal, na.value = "lightgrey", space = "Lab",
name = paste(legend_title))
}else{
p <- p + scale_fill_gradientn(colors = color_pal,
limits = limit_plot, na.value = "lightgrey", space = "Lab",
name = paste(legend_title))
}
p <- p + theme_bw() + coord_fixed() + xlab('Variable 2 (Y)') + ylab("Variable 1 (X)")
if(significance){
p <- p + geom_text(aes_(label = ~sign_label, color = ~text_color), size = fontsize, na.rm=TRUE)
}else{
p <- p + geom_text(aes_(label = ~value, color = ~text_color), size = fontsize, na.rm = TRUE)
}
p <- p + scale_color_manual(values = c("high" = "white", "low" = "black")) + guides(color = "none")
p <- p + theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
p <- p + scale_y_discrete(limits = rev(levels(df_long$Var1)))
if(significance){
if(use_p.adjust){
p <- p + labs(caption = paste0("Signif. codes:"," '*' ","p.value <", sign.level, " (p.value correction method: ", pw_qad$p.adjust.method, ")"))
message(paste0("p.values are adjusted by using the method ", pw_qad$p.adjust.method))
}else{
p <- p + labs(caption = paste0("Signif. codes:"," '*' ","p.value <", sign.level))
}
}
p <- p + ggtitle(title)
return(p)
}
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6,
white_font = 0.5,
scale = "rel")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = FALSE,
fontsize = 6,
white_font = 0.5,
scale = "rel")
heatmap.qad(model,
select = "dependence",
significance = FALSE,
use_p.adjust = TRUE,
fontsize = 6,
white_font = 0.5,
scale = "rel")
heatmap.qad(model,
select = "max.dependence",
significance = FALSE,
use_p.adjust = TRUE,
fontsize = 6,
white_font = 0.5,
scale = "rel")
heatmap.qad(model,
select = "max.dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6,
white_font = 0.5,
scale = "rel")
heatmap.qad(model,
select = "asymmetr",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6,
white_font = 0.5,
scale = "rel")
heatmap.qad(model,
select = "asymmetry",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6,
white_font = 0.5,
scale = "rel")
heatmap.qad <- function(pw_qad,
select = c('dependence','max.dependence','asymmetry'),
fontsize = 4,
significance = FALSE,
use_p.adjust = TRUE,
sign.level = 0.05,
scale = "abs",
color = "plasma",
white_font = 0.7,
rb_values = c(10, 0.315, 0.15),
title = ""){
prepare_data_long <- function(matr, matr.p, n_round = 3){
df_matr <- as.data.frame(as.table(round(as.matrix(matr), n_round)))
names(df_matr) <- c("Var1", "Var2", "value")
df_p <- as.data.frame(as.table(as.matrix(matr.p)))
names(df_p) <- c("Var1", "Var2", "p.value")
df_p$sign <- with(df_p, ifelse(p.value < sign.level & !is.na(p.value), "*", ""))
df_matr <- dplyr::left_join(df_matr, df_p, by = c("Var1", "Var2"))
df_matr$sign_label <- with(df_matr, ifelse(is.na(value), NA, paste0(value,sign)))
return(df_matr)
}
if(color == "rainbow"){
color_pal <- rainbow(rb_values[1], start = rb_values[2], end = rb_values[3])
}else{
color_pal <- viridis(5, option = color, direction = -1)
}
limit_plot <- c(0,1)
#Select dependence measure
if(select == 'dependence'){
if(use_p.adjust){
df_long <- prepare_data_long(pw_qad$q, pw_qad$q_p.values.adjusted)
}else{
df_long <- prepare_data_long(pw_qad$q, pw_qad$q_p.values)
}
legend_title <- "Dependence: \nq:=q(x,y)"
}else if(select == 'max.dependence'){
if(use_p.adjust){
df_long <- prepare_data_long(pw_qad$max.dependence, pw_qad$max.dependence_p.values.adjusted)
}else{
df_long <- prepare_data_long(pw_qad$max.dependence, pw_qad$max.dependence_p.values)
}
legend_title <- "Max dependence:=\nmax(q(x,y)+q(y,x))"
}else if(select == 'asymmetry'){
if(use_p.adjust){
df_long <- prepare_data_long(pw_qad$asymmetry, pw_qad$asymmetry_p.values.adjusted)
}else{
df_long <- prepare_data_long(pw_qad$asymmetry, pw_qad$asymmetry_p.values)
}
limit_plot <- c(-1,1)
legend_title <- "Asymmetry: \na:=q(x,y)-q(y,x)"
if(color == "rainbow"){
color_pal <- c(rev(rainbow(rb_values[1], start = rb_values[2], end = rb_values[3])),rainbow(rb_values[1], start = rb_values[2], end = rb_values[3])[-1])
}else{
color_pal <- c(rev(viridis(5, option = color, direction = -1)),viridis(5, option = color, direction = -1)[-1])
}
}else{
stop('Select an appropriate select variable. Options are c("dependence","max.dependence","asymmetry")')
}
df_long$text_color <- ifelse(df_long$value > white_font, "high", "low")
#Plot heatmap
p <- ggplot(data = df_long, aes_(x = ~Var2, y = ~Var1, fill = ~value))
p <- p + geom_tile(color = 'white')
if(scale == "rel"){
p <- p + scale_fill_gradientn(colors = color_pal, na.value = "lightgrey", space = "Lab",
name = paste(legend_title))
}else{
p <- p + scale_fill_gradientn(colors = color_pal,
limits = limit_plot, na.value = "lightgrey", space = "Lab",
name = paste(legend_title))
}
p <- p + theme_bw() + coord_fixed() + xlab('Variable 2 (Y)') + ylab("Variable 1 (X)")
if(significance){
p <- p + geom_text(aes_(label = ~sign_label, color = ~text_color), size = fontsize, na.rm=TRUE)
}else{
p <- p + geom_text(aes_(label = ~value, color = ~text_color), size = fontsize, na.rm = TRUE)
}
p <- p + scale_color_manual(values = c("high" = "white", "low" = "black")) + guides(color = "none")
p <- p + theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
p <- p + scale_y_discrete(limits = rev(levels(df_long$Var1)))
if(significance){
if(all(is.na(df_long$p.value))){
warning(paste0("No p.values available"))
}else{
if(use_p.adjust){
p <- p + labs(caption = paste0("Signif. codes:"," '*' ","p.value <", sign.level, " (p.value correction method: ", pw_qad$p.adjust.method, ")"))
message(paste0("p.values are adjusted by using the method ", pw_qad$p.adjust.method))
}else{
p <- p + labs(caption = paste0("Signif. codes:"," '*' ","p.value <", sign.level))
}
}
}
p <- p + ggtitle(title)
return(p)
}
heatmap.qad(model,
select = "asymmetry",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6,
white_font = 0.5,
scale = "rel")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6,
white_font = 0.5,
scale = "rel")
#Fit qad
model <- pairwise.qad(sample_df, p.value = TRUE,
p.adjust.method = "holm")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6,
white_font = 0.5,
scale = "rel")
#Fit qad
model <- pairwise.qad(sample_df, p.value = TRUE,
p.adjust.method = "bonferroni")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = FALSE,
fontsize = 6, scale = "abs")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6, scale = "abs")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6,
white_font = 0.5,
scale = "rel")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6, scale = "abs")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6, scale = "abs", white_font = 1)
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6, scale = "abs", white_font = 0)
sessionInfo()
library(qad)
n <- 100
x1 <- runif(n, 0, 1)
x2 <- x1^2 + rnorm(n, 0, 0.1)
x3 <- runif(n, 0, 1)
x4 <- x3 - x2 + rnorm(n, 0, 0.1)
sample_df <- data.frame(x1,x2,x3,x4)
#Fit qad
model <- pairwise.qad(sample_df, p.value = TRUE,
p.adjust.method = "bonferroni")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = FALSE,
fontsize = 6, scale = "abs")
#Fit qad
model <- pairwise.qad(sample_df, p.value = FALSE,
p.adjust.method = "bonferroni")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = FALSE,
fontsize = 6, scale = "abs")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6, scale = "abs")
model$q_p.values.adjusted
heatmap.qad <- function(pw_qad,
select = c('dependence','max.dependence','asymmetry'),
fontsize = 4,
significance = FALSE,
use_p.adjust = TRUE,
sign.level = 0.05,
scale = "abs",
color = "plasma",
white_font = 0.7,
rb_values = c(10, 0.315, 0.15),
title = ""){
prepare_data_long <- function(matr, matr.p, n_round = 3){
df_matr <- as.data.frame(as.table(round(as.matrix(matr), n_round)))
names(df_matr) <- c("Var1", "Var2", "value")
df_p <- as.data.frame(as.table(as.matrix(matr.p)))
names(df_p) <- c("Var1", "Var2", "p.value")
df_p$sign <- with(df_p, ifelse(p.value < sign.level & !is.na(p.value), "*", ""))
df_matr <- dplyr::left_join(df_matr, df_p, by = c("Var1", "Var2"))
df_matr$sign_label <- with(df_matr, ifelse(is.na(value), NA, paste0(value,sign)))
return(df_matr)
}
if(color == "rainbow"){
color_pal <- rainbow(rb_values[1], start = rb_values[2], end = rb_values[3])
}else{
color_pal <- viridis(5, option = color, direction = -1)
}
limit_plot <- c(0,1)
#Select dependence measure
if(select == 'dependence'){
if(use_p.adjust){
df_long <- prepare_data_long(pw_qad$q, pw_qad$q_p.values.adjusted)
}else{
df_long <- prepare_data_long(pw_qad$q, pw_qad$q_p.values)
}
legend_title <- "Dependence: \nq:=q(x,y)"
}else if(select == 'max.dependence'){
if(use_p.adjust){
df_long <- prepare_data_long(pw_qad$max.dependence, pw_qad$max.dependence_p.values.adjusted)
}else{
df_long <- prepare_data_long(pw_qad$max.dependence, pw_qad$max.dependence_p.values)
}
legend_title <- "Max dependence:=\nmax(q(x,y)+q(y,x))"
}else if(select == 'asymmetry'){
if(use_p.adjust){
df_long <- prepare_data_long(pw_qad$asymmetry, pw_qad$asymmetry_p.values.adjusted)
}else{
df_long <- prepare_data_long(pw_qad$asymmetry, pw_qad$asymmetry_p.values)
}
limit_plot <- c(-1,1)
legend_title <- "Asymmetry: \na:=q(x,y)-q(y,x)"
if(color == "rainbow"){
color_pal <- c(rev(rainbow(rb_values[1], start = rb_values[2], end = rb_values[3])),rainbow(rb_values[1], start = rb_values[2], end = rb_values[3])[-1])
}else{
color_pal <- c(rev(viridis(5, option = color, direction = -1)),viridis(5, option = color, direction = -1)[-1])
}
}else{
stop('Select an appropriate select variable. Options are c("dependence","max.dependence","asymmetry")')
}
df_long$text_color <- ifelse(df_long$value > white_font, "high", "low")
#Plot heatmap
p <- ggplot(data = df_long, aes_(x = ~Var2, y = ~Var1, fill = ~value))
p <- p + geom_tile(color = 'white')
if(scale == "rel"){
p <- p + scale_fill_gradientn(colors = color_pal, na.value = "lightgrey", space = "Lab",
name = paste(legend_title))
}else{
p <- p + scale_fill_gradientn(colors = color_pal,
limits = limit_plot, na.value = "lightgrey", space = "Lab",
name = paste(legend_title))
}
p <- p + theme_bw() + coord_fixed() + xlab('Variable 2 (Y)') + ylab("Variable 1 (X)")
if(significance){
p <- p + geom_text(aes_(label = ~sign_label, color = ~text_color), size = fontsize, na.rm=TRUE)
}else{
p <- p + geom_text(aes_(label = ~value, color = ~text_color), size = fontsize, na.rm = TRUE)
}
p <- p + scale_color_manual(values = c("high" = "white", "low" = "black")) + guides(color = "none")
p <- p + theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
p <- p + scale_y_discrete(limits = rev(levels(df_long$Var1)))
if(significance){
if(all(is.na(df_long$p.value))){
warning(paste0("No p.values available"))
}else{
if(use_p.adjust){
p <- p + labs(caption = paste0("Signif. codes:"," '*' ","p.value <", sign.level, " (p.value correction method: ", pw_qad$p.adjust.method, ")"))
message(paste0("p.values are adjusted by using the method ", pw_qad$p.adjust.method))
}else{
p <- p + labs(caption = paste0("Signif. codes:"," '*' ","p.value <", sign.level))
}
}
}
p <- p + ggtitle(title)
return(p)
}
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6, scale = "abs")
library(ggplot2)
library(viridis)
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6, scale = "abs")
library(qad)
library(qad)
n <- 100
x1 <- runif(n, 0, 1)
x2 <- x1^2 + rnorm(n, 0, 0.1)
x3 <- runif(n, 0, 1)
x4 <- x3 - x2 + rnorm(n, 0, 0.1)
sample_df <- data.frame(x1,x2,x3,x4)
#Fit qad
model <- pairwise.qad(sample_df, p.value = FALSE,
p.adjust.method = "bonferroni")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6, scale = "abs")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6, scale = "abs", white_font = 0)
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6,
white_font = 0.5,
scale = "rel")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6,
scale = "rel")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6,
scale = "abs")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6)
#Fit qad
model <- pairwise.qad(sample_df, p.value = TRUE,
p.adjust.method = "fdr")
heatmap.qad(model,
select = "dependence",
significance = TRUE,
use_p.adjust = TRUE,
fontsize = 6)
x <- runif(10)
usethis::use_data(x)
data <- read.table("C:/Users/Florian/Doktorat/Publications/2022 - qad-An R-package for quantifying asymmetric dependence/RCodes/Data/data.txt", header = T)
View(data)
qad::qad(data)
test <- qad::qad(data)
plot(test)
usethis::use_data(data)
roxygen2::roxygenise()
PlantDiversity <- read.table("C:/Users/Florian/Doktorat/Publications/2022 - qad-An R-package for quantifying asymmetric dependence/RCodes/Data/data.txt", header = T)
usethis::use_data(PlantDiversity)
roxygen2::roxygenise()
library(qad)
data("PlantDiversity")
roxygen2::roxygenise()
data("PlantDiversity")
qad(PlantDiversity)
fit <- qad(PlantDiversity)
plot(fit, copula = TRUE)
plot(fit, copula = FALSE)
data("PlantDiversity")
fit <- qad(PlantDiversity)
conditioned = "x1"
setminus(c("x1", "x2"), conditioned)
setdiff(c("x1", "x2"), conditioned)
cat(paste0("Intervalls for the variable", setdiff(c("x1", "x2"), conditioned)," \n"))
cat(paste0("Intervalls for the variable ", setdiff(c("x1", "x2"), conditioned)," \n"))
toupper(setdiff(c("x1", "x2"), conditioned))
cat(paste0("\nProbability that ",toupper(setdiff(c("x1", "x2"), conditioned))," given ",toupper(conditioned),"=",conditioned," lies in the interval I_i :\n"))
library(qad)
library(qad)
data("PlanDiversity")
library(qad)
data("PlantDiversity")
View(PlantDiversity)
names(PlantDiversity)
roxygen2::roxygenise()
